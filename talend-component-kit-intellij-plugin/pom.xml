<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright (C) 2006-2018 Talend Inc. - www.talend.com
   Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="
          http://maven.apache.org/POM/4.0.0
          http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <parent>
    <artifactId>component-runtime</artifactId>
    <groupId>org.talend.sdk.component</groupId>
    <version>0.0.5-SNAPSHOT</version>
  </parent>

  <modelVersion>4.0.0</modelVersion>

  <artifactId>talend-component-kit-intellij-plugin</artifactId>
  <name>Component Runtime :: Intellij Plugin</name>
  <description>Provides Talend Component Kit Integration with Intellij Idea.</description>

  <properties>
    <talend.build.name>${talend.build.name.base}.intellij</talend.build.name>

    <idea.unpacked.folder>${project.basedir}/.cache/idea/</idea.unpacked.folder>
    <idea.version>2017.3.5</idea.version>
  </properties>

  <build>
    <resources>
      <resource>
        <directory>src/main/resources</directory>
        <filtering>true</filtering>
        <excludes>
          <exclude>**/*.png</exclude>
        </excludes>
      </resource>
      <resource>
        <directory>src/main/resources</directory>
        <filtering>false</filtering>
        <includes>
          <include>**/*.png</include>
        </includes>
      </resource>
    </resources>

    <plugins>
      <plugin>
        <groupId>com.googlecode.maven-download-plugin</groupId>
        <artifactId>download-maven-plugin</artifactId>
        <version>${download-plugin.version}</version>
        <executions>
          <execution>
            <id>download-idea</id>
            <phase>initialize</phase>
            <goals>
              <goal>wget</goal>
            </goals>
            <configuration>
              <url>
                https://www.jetbrains.com/intellij-repository/releases/com/jetbrains/intellij/idea/ideaIC/${idea.version}/ideaIC-${idea.version}.zip
              </url>
              <overwrite>false</overwrite>
              <checkSignature>false</checkSignature> <!-- too slow -->
              <outputFileName>local_idea.zip</outputFileName>
              <outputDirectory>${idea.unpacked.folder}</outputDirectory>
              <unpack>true</unpack>
              <cacheDirectory>${project.basedir}/.cache</cacheDirectory>

              <!-- the zip is big, avoid to compute it each time -->
              <md5>0b5dd432a16707a81cef20843e243174</md5>
              <sha1>69a951f31e6bb7bb9ee36c3107ce120d50229f95</sha1>
              <sha512>e5d74a63e915dd98b0e3ba12616a056871fb8c6d0a43c89b72539dd2bf3970869a92ac3d5634c4af6bddf74efdae0b2f4f3ca8a33ca86cf62cbda115461c4cda</sha512>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <groupId>org.codehaus.gmavenplus</groupId>
        <artifactId>gmavenplus-plugin</artifactId>
        <version>${gmavenplus.version}</version>
        <executions>
          <execution>
            <id>setup-deps</id>
            <phase>initialize</phase>
            <goals>
              <goal>execute</goal>
            </goals>
            <configuration>
              <allowSystemExits>true</allowSystemExits>
              <scripts>
                <script>${project.basedir}/src/build/IdeaDependencies.groovy</script>
              </scripts>
            </configuration>
          </execution>
        </executions>
        <dependencies>
          <dependency>
            <groupId>org.codehaus.groovy</groupId>
            <artifactId>groovy-all</artifactId>
            <version>${groovy.version}</version>
          </dependency>
        </dependencies>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-assembly-plugin</artifactId>
        <version>2.5.3</version>
        <configuration>
          <descriptor>src/assembly/plugin.xml</descriptor>
        </configuration>
        <executions>
          <execution>
            <id>package-plugin</id>
            <phase>package</phase>
            <goals>
              <goal>single</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
      <!-- todo: deploy plugin for release profile -->
    </plugins>
  </build>

  <profiles>
    <profile>
      <id>ide</id>

      <repositories>
        <repository>
          <id>idea-local</id>
          <url>file:${project.basedir}/.cache/m2/localrepository</url>
        </repository>
      </repositories>

      <dependencies>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_openapi</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_idea</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_util</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_gson-2.8.2</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_jsr305</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_jdom</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_swingx-core-1.6.2</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_slf4j-api-1.7.10</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>lib_extensions</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>plugins_properties_lib_properties</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>plugins_maven_lib_maven</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
        <dependency>
          <groupId>com.intellij.idea</groupId>
          <artifactId>plugins_gradle_lib_gradle</artifactId>
          <version>${idea.version}</version>
          <scope>provided</scope>
        </dependency>
      </dependencies>
    </profile>
  </profiles>
</project>
